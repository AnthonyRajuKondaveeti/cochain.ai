{% extends "base.html" %} {% block title %}Complete Your Profile - CoChain.ai{%
endblock %} {% block content %}
<div class="min-h-screen bg-gray-50 py-12">
  <div class="max-w-4xl mx-auto px-4 sm:px-6">
    
    <!-- Header & Progress -->
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-light text-gray-900 mb-2">
        Complete your profile
      </h1>
      <p class="text-gray-500 mb-8">
        Help us personalize your open source recommendations.
      </p>

      <!-- GitHub-style Progress Steps -->
      <nav aria-label="Progress">
        <ol role="list" class="flex items-center justify-center">
          <!-- Step 1: Complete -->
          <li class="relative pr-8 sm:pr-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-green-600"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-green-600 hover:bg-green-700">
              <i class="fas fa-check text-white text-sm"></i>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-semibold text-green-700 w-max">Account</span>
          </li>
          <!-- Step 2: Current -->
          <li class="relative px-8 sm:px-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-gray-200"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 border-2 border-blue-600 bg-white" aria-current="step">
              <span class="h-2.5 w-2.5 rounded-full bg-blue-600"></span>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-bold text-blue-600 w-max">Profile</span>
          </li>
          <!-- Step 3: Upcoming -->
          <li class="relative pl-8 sm:pl-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-gray-200"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-white border-2 border-gray-300 hover:border-gray-400">
              <span class="h-2.5 w-2.5 rounded-full bg-transparent group-hover:bg-gray-300"></span>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-medium text-gray-500 w-max">Explore</span>
          </li>
        </ol>
      </nav>
    </div>

    <!-- Profile Form Card -->
    <div class="bg-white rounded-md shadow-sm border border-gray-200 overflow-hidden">
      <!-- Card Header -->
      <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
         <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Developer Profile</h3>
      </div>

      <div class="p-6 sm:p-8">
        <form
          id="profile-form"
          method="POST"
          action="{{ url_for('profile_setup') }}"
        >
          <!-- Education Background Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-graduation-cap text-gray-400 mr-2"></i> Education
            </h4>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- Education Level -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Education Level <span class="text-red-600">*</span>
                </label>
                <select
                  name="education_level"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="">Select level...</option>
                  <option value="high_school">High School</option>
                  <option value="undergraduate">Undergraduate</option>
                  <option value="graduate">Graduate/Masters</option>
                  <option value="professional">Professional/PhD</option>
                  <option value="self_taught">Self-Taught</option>
                </select>
              </div>

              <!-- Current Year -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Current Year
                </label>
                <select
                  name="current_year"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="">Select year...</option>
                  <option value="freshman">Freshman</option>
                  <option value="sophomore">Sophomore</option>
                  <option value="junior">Junior</option>
                  <option value="senior">Senior</option>
                  <option value="graduated">Graduated</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <!-- Field of Study -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                Field of Study
              </label>
              <input
                type="text"
                name="field_of_study"
                placeholder="e.g., Computer Science, Engineering, Business..."
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
              />
            </div>

            <!-- Bio / Career Aspirations -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                Bio / Career Aspirations <span class="text-red-600">*</span>
              </label>
              <textarea
                name="bio"
                rows="3"
                placeholder="Tell us about your career goals..."
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                required
              ></textarea>
              <p class="text-xs text-gray-500 mt-1">
                Minimum 50 characters. Markdown supported.
              </p>
            </div>

            <!-- LinkedIn Profile -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                LinkedIn Profile (Optional)
              </label>
              <input
                type="url"
                name="linkedin_url"
                placeholder="https://www.linkedin.com/in/your-profile"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
              />
              <p class="text-xs text-gray-500 mt-1">
                Share your LinkedIn profile to help collaborators learn more about you
              </p>
            </div>

            <!-- GitHub Profile -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="github_url">
                <i class="fab fa-github text-gray-400 mr-1"></i>
                GitHub Profile (Optional)
              </label>
              <input
                type="url"
                name="github_url"
                placeholder="https://github.com/your-username"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
              />
              <p class="text-xs text-gray-500 mt-1">
                Share your GitHub profile to showcase your code repositories
              </p>
            </div>
          </div>

          <!-- Skill Level Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-code-branch text-gray-400 mr-2"></i> Skill Level
            </h4>

            <div class="grid md:grid-cols-4 gap-4">
              {% for level in [
                  {'val': 'beginner', 'label': 'Beginner', 'desc': 'Just starting out', 'icon': 'fa-seedling'},
                  {'val': 'intermediate', 'label': 'Intermediate', 'desc': 'Some experience', 'icon': 'fa-code'},
                  {'val': 'advanced', 'label': 'Advanced', 'desc': 'Very experienced', 'icon': 'fa-rocket'},
                  {'val': 'expert', 'label': 'Expert', 'desc': 'Professional level', 'icon': 'fa-trophy'}
              ] %}
              <label class="cursor-pointer relative">
                <input
                  type="radio"
                  name="overall_skill_level"
                  value="{{ level.val }}"
                  class="peer hidden"
                  {% if level.val == 'intermediate' %}checked{% endif %}
                />
                <div class="h-full border border-gray-300 rounded-md p-4 text-center hover:border-blue-400 hover:shadow-sm transition-all peer-checked:border-blue-600 peer-checked:ring-1 peer-checked:ring-blue-600 peer-checked:bg-blue-50">
                  <i class="fas {{ level.icon }} text-xl text-gray-500 peer-checked:text-blue-600 mb-2"></i>
                  <div class="font-semibold text-gray-900 peer-checked:text-blue-800 text-sm">{{ level.label }}</div>
                  <div class="text-xs text-gray-500 mt-1">{{ level.desc }}</div>
                </div>
              </label>
              {% endfor %}
            </div>
          </div>

          <!-- Areas of Interest Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="far fa-heart text-gray-400 mr-2"></i> Areas of Interest
              <span class="ml-2 text-xs font-normal text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">Select at least 2</span>
            </h4>

            <div class="grid md:grid-cols-3 gap-3">
              {% for interest in interest_areas %}
              <label class="cursor-pointer relative">
                <input
                  type="checkbox"
                  name="areas_of_interest"
                  value="{{ interest.name }}"
                  class="peer hidden interest-checkbox"
                />
                <div class="flex items-start p-3 border border-gray-300 rounded-md hover:border-blue-400 transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50 h-full">
                  <div class="flex-shrink-0 mt-0.5">
                      <!-- Checkbox visual -->
                      <div>
                          <i class="fas {{interest.icon}} text-2xl mb-2"></i>
                      </div>
                  </div>
                  <div class="ml-3">
                    <div class="text-sm font-semibold text-gray-900 peer-checked:text-blue-800 capitalize">
                      {{ interest.name.replace('_', ' ') }}
                    </div>
                    <div class="text-xs text-gray-500 mt-0.5 leading-tight">
                      {{ interest.description[:40] }}...
                    </div>
                  </div>
                </div>
              </label>
              {% endfor %}
            </div>
            <p class="text-xs text-gray-500 mt-2 text-right" id="interest-count">
              Selected: 0
            </p>
          </div>

          <!-- Tech Stack (Languages & Frameworks) -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-layer-group text-gray-400 mr-2"></i> Tech Stack
            </h4>

            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Languages</label>
                <div class="flex flex-wrap gap-2">
                  {% for lang in ['Python', 'JavaScript', 'Java', 'C++', 'C#', 'Ruby', 'Go', 'Swift', 'Kotlin', 'PHP', 'TypeScript', 'Rust'] %}
                  <label class="cursor-pointer">
                    <input type="checkbox" name="programming_languages" value="{{ lang }}" class="peer hidden" />
                    <span class="inline-block px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 transition-colors">
                      {{ lang }}
                    </span>
                  </label>
                  {% endfor %}
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Frameworks</label>
                <div class="flex flex-wrap gap-2">
                  {% for framework in ['React', 'Vue.js', 'Angular', 'Node.js', 'Django', 'Flask', 'Spring', 'Express', 'Laravel', 'Rails', 'TensorFlow', 'PyTorch'] %}
                  <label class="cursor-pointer">
                    <input type="checkbox" name="frameworks_known" value="{{ framework }}" class="peer hidden" />
                    <span class="inline-block px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 transition-colors">
                      {{ framework }}
                    </span>
                  </label>
                  {% endfor %}
                </div>
            </div>
          </div>

          <!-- Preferences & Goals -->
          <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-sliders-h text-gray-400 mr-2"></i> Preferences
            </h4>

            <div class="mb-4">
                 <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Learning Goals
                </label>
                <textarea
                  name="learning_goals"
                  rows="2"
                  placeholder="What do you want to achieve?"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                ></textarea>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
              <!-- Time Commitment -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Time Commitment
                </label>
                <select
                  name="time_commitment"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="part_time">Part-time</option>
                  <option value="full_time">Full-time</option>
                  <option value="weekend_warrior">Weekends</option>
                </select>
              </div>

              <!-- Project Size -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Preferred Size
                </label>
                <select
                  name="preferred_project_size"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="small">Small (1-2 weeks)</option>
                  <option value="medium" selected>Medium (1-2 months)</option>
                  <option value="large">Large (3+ months)</option>
                </select>
              </div>

              <!-- Team Preference -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Team Preference
                </label>
                <select
                  name="team_preference"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="solo">Solo</option>
                  <option value="small_team">Small team (2-3)</option>
                  <option value="large_team">Large team (4+)</option>
                  <option value="any" selected>No preference</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Footer Actions -->
          <div class="pt-6 border-t border-gray-200 flex justify-between items-center">
            <button
              type="button"
              onclick="window.location.href='{{ url_for('dashboard') }}'"
              class="text-gray-600 hover:text-blue-600 font-medium text-sm transition"
            >
              Skip for now
            </button>

            <button
              type="submit"
              class="bg-green-600 text-white px-6 py-2.5 rounded-md font-bold text-sm hover:bg-green-700 transition shadow-sm border border-green-700"
            >
              Save Profile
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Track interest selections for visual logic if needed
  document.querySelectorAll(".interest-checkbox").forEach((checkbox) => {
    checkbox.addEventListener("change", function () {
      const parentDiv = this.nextElementSibling.querySelector('div:first-child');
      const checkIcon = parentDiv.querySelector('i');
      
      if(this.checked) {
          checkIcon.classList.remove('opacity-0');
      } else {
          checkIcon.classList.add('opacity-0');
      }

      const count = document.querySelectorAll(
        ".interest-checkbox:checked"
      ).length;
      document.getElementById(
        "interest-count"
      ).textContent = `Selected: ${count}`;
    });
  });

  // Form submission logic
  document
    .getElementById("profile-form")
    .addEventListener("submit", function (e) {
      e.preventDefault();

      // Validate interests
      const interests = document.querySelectorAll(".interest-checkbox:checked");
      if (interests.length < 2) {
        showToast("Please select at least 2 areas of interest", "warning");
        return;
      }

      showLoading();

      const formData = new FormData(this);

      // Convert FormData to JSON
      const data = {
        education_level: formData.get("education_level"),
        current_year: formData.get("current_year"),
        field_of_study: formData.get("field_of_study"),
        bio: formData.get("bio"),
        linkedin_url: formData.get("linkedin_url"),
        github_url: formData.get("github_url"),
        overall_skill_level: formData.get("overall_skill_level"),
        areas_of_interest: formData.getAll("areas_of_interest"),
        programming_languages: formData.getAll("programming_languages"),
        frameworks_known: formData.getAll("frameworks_known"),
        learning_goals: formData.get("learning_goals"),
        time_commitment: formData.get("time_commitment"),
        preferred_project_size: formData.get("preferred_project_size"),
        team_preference: formData.get("team_preference"),
      };

      fetch('{{ url_for("profile_setup") }}', {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          hideLoading();
          if (data.success) {
            showToast(
              "Profile saved!",
              "success"
            );
            setTimeout(() => {
              window.location.href = '{{ url_for("dashboard") }}';
            }, 1000);
          } else {
            showToast(data.error || "Failed to update profile", "error");
          }
        })
        .catch((error) => {
          hideLoading();
          showToast("Error: " + error.message, "error");
        });
    });
</script>
{% endblock %}