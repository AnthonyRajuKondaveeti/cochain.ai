{% extends "base.html" %} 
{% block title %}Complete Your Profile - CoChain.ai{% endblock %} 

{% block content %}
<!-- Custom CSS for Shooting Stars & Animations -->
<style>
  /* Night Sky Background */
  .night-sky-bg {
    background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
  }

  /* Star styling */
  .star {
    position: absolute;
    top: 50%;
    left: 50%;
    height: 2px;
    background: linear-gradient(-45deg, #5f91ff, rgba(0, 0, 255, 0));
    filter: drop-shadow(0 0 6px #699bff);
    animation: tail 3000ms ease-in-out infinite, shooting 3000ms ease-in-out infinite;
    opacity: 0;
    z-index: -1;
  }

  /* The glowing head of the star */
  .star::before {
    content: '';
    position: absolute;
    top: calc(50% - 1px);
    right: 0;
    height: 2px;
    background: linear-gradient(-45deg, rgba(0, 0, 255, 0), #5f91ff, rgba(0, 0, 255, 0));
    transform: translateX(50%) rotateZ(45deg);
    border-radius: 100%;
    animation: shining 3000ms ease-in-out infinite;
  }

  /* The trail of the star */
  .star::after {
    content: '';
    position: absolute;
    top: calc(50% - 1px);
    right: 0;
    height: 2px;
    background: linear-gradient(-45deg, rgba(0, 0, 255, 0), #5f91ff, rgba(0, 0, 255, 0));
    transform: translateX(50%) rotateZ(45deg);
    border-radius: 100%;
    animation: shining 3000ms ease-in-out infinite;
  }

  /* Animations */
  @keyframes tail {
    0% { width: 0; }
    30% { width: 100px; }
    100% { width: 0; }
  }

  @keyframes shooting {
    0% { transform: translateX(0); }
    100% { transform: translateX(300px); }
  }

  @keyframes shining {
    0% { width: 0; }
    50% { width: 30px; }
    100% { width: 0; }
  }
  
  /* Twinkling static stars */
  .static-star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--duration) ease-in-out infinite;
    opacity: var(--opacity);
  }
  
  @keyframes twinkle {
    0%, 100% { opacity: var(--opacity); transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }
</style>

<!-- BACKGROUND CONTAINER (Fixed position, behind everything) -->
<div class="fixed inset-0 night-sky-bg overflow-hidden pointer-events-none" style="z-index: -1;">
  <div id="star-container"></div>
  <div id="static-star-container"></div>
</div>

<!-- CONTENT WRAPPER -->
<div class="min-h-screen relative z-10 py-12">
  <div class="max-w-4xl mx-auto px-4 sm:px-6">
    
    <!-- Header & Progress -->
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-light text-white mb-2">
        Complete your profile
      </h1>
      <p class="text-gray-300 mb-8">
        Help us personalize your open source recommendations.
      </p>

      <!-- GitHub-style Progress Steps -->
      <nav aria-label="Progress">
        <ol role="list" class="flex items-center justify-center">
          <!-- Step 1: Complete -->
          <li class="relative pr-8 sm:pr-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-green-500"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-green-600 hover:bg-green-700 border-2 border-green-600">
              <i class="fas fa-check text-white text-sm"></i>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-semibold text-green-400 w-max">Account</span>
          </li>
          <!-- Step 2: Current -->
          <li class="relative px-8 sm:px-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-gray-600"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-white border-2 border-blue-500 shadow-glow" aria-current="step">
              <span class="h-2.5 w-2.5 rounded-full bg-blue-600"></span>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-bold text-blue-400 w-max">Profile</span>
          </li>
          <!-- Step 3: Upcoming -->
          <li class="relative pl-8 sm:pl-20">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
              <div class="h-0.5 w-full bg-gray-600"></div>
            </div>
            <a href="#" class="relative flex h-8 w-8 items-center justify-center rounded-full bg-gray-800 border-2 border-gray-500 hover:border-gray-400">
              <span class="h-2.5 w-2.5 rounded-full bg-transparent group-hover:bg-gray-300"></span>
            </a>
            <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-medium text-gray-400 w-max">Explore</span>
          </li>
        </ol>
      </nav>
    </div>

    <!-- Profile Form Card -->
    <div class="bg-white/95 backdrop-blur-sm rounded-md shadow-xl border border-gray-200 overflow-hidden relative">
      <!-- Card Header -->
      <div class="bg-gray-50/80 px-6 py-4 border-b border-gray-200">
         <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Developer Profile</h3>
      </div>

      <div class="p-6 sm:p-8">
        <form
          id="profile-form"
          method="POST"
          action="{{ url_for('profile_setup') }}"
        >
          <!-- Education Background Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-graduation-cap text-gray-400 mr-2"></i> Education
            </h4>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- Education Level -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Education Level <span class="text-red-600">*</span>
                </label>
                <select
                  name="education_level"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                >
                  <option value="">Select level...</option>
                  <option value="high_school">High School</option>
                  <option value="undergraduate">Undergraduate</option>
                  <option value="graduate">Graduate/Masters</option>
                  <option value="professional">Professional/PhD</option>
                  <option value="self_taught">Self-Taught</option>
                </select>
              </div>

              <!-- Current Year -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Current Year
                </label>
                <select
                  name="current_year"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                >
                  <option value="">Select year...</option>
                  <option value="freshman">Freshman</option>
                  <option value="sophomore">Sophomore</option>
                  <option value="junior">Junior</option>
                  <option value="senior">Senior</option>
                  <option value="graduated">Graduated</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <!-- Field of Study -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                Field of Study
              </label>
              <input
                type="text"
                name="field_of_study"
                placeholder="e.g., Computer Science, Engineering, Business..."
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
              />
            </div>

            <!-- Bio / Career Aspirations -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                Bio / Career Aspirations <span class="text-red-600">*</span>
              </label>
              <textarea
                name="bio"
                rows="3"
                placeholder="Tell us about your career goals..."
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                required
              ></textarea>
              <p class="text-xs text-gray-500 mt-1">
                Minimum 50 characters. Markdown supported.
              </p>
            </div>

            <!-- LinkedIn Profile -->
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                LinkedIn Profile (Optional)
              </label>
              <input
                type="url"
                name="linkedin_url"
                placeholder="https://www.linkedin.com/in/your-profile"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
              />
            </div>

            <!-- GitHub Profile -->
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="github_url">
                <i class="fab fa-github text-gray-400 mr-1"></i>
                GitHub Profile (Optional)
              </label>
              <input
                type="url"
                name="github_url"
                placeholder="https://github.com/your-username"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
              />
            </div>
          </div>

          <!-- Skill Level Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-code-branch text-gray-400 mr-2"></i> Skill Level
            </h4>

            <div class="grid md:grid-cols-4 gap-4">
              {% for level in [
                  {'val': 'beginner', 'label': 'Beginner', 'desc': 'Just starting out', 'icon': 'fa-seedling'},
                  {'val': 'intermediate', 'label': 'Intermediate', 'desc': 'Some experience', 'icon': 'fa-code'},
                  {'val': 'advanced', 'label': 'Advanced', 'desc': 'Very experienced', 'icon': 'fa-rocket'},
                  {'val': 'expert', 'label': 'Expert', 'desc': 'Professional level', 'icon': 'fa-trophy'}
              ] %}
              <label class="cursor-pointer relative group">
                <input
                  type="radio"
                  name="overall_skill_level"
                  value="{{ level.val }}"
                  class="peer hidden"
                  {% if level.val == 'intermediate' %}checked{% endif %}
                />
                <div class="h-full bg-white border border-gray-200 rounded-md p-4 text-center hover:border-blue-400 hover:shadow-md transition-all peer-checked:border-blue-600 peer-checked:ring-1 peer-checked:ring-blue-600 peer-checked:bg-blue-50">
                  <i class="fas {{ level.icon }} text-xl text-gray-400 peer-checked:text-blue-600 mb-2 transition-colors"></i>
                  <div class="font-semibold text-gray-900 peer-checked:text-blue-800 text-sm">{{ level.label }}</div>
                  <div class="text-xs text-gray-500 mt-1">{{ level.desc }}</div>
                </div>
              </label>
              {% endfor %}
            </div>
          </div>

          <!-- Areas of Interest Section -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="far fa-heart text-gray-400 mr-2"></i> Areas of Interest
              <span class="ml-2 text-xs font-normal text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full border border-gray-200">Select at least 2</span>
            </h4>

            <div class="grid md:grid-cols-3 gap-3">
              {% for interest in interest_areas %}
              <label class="cursor-pointer relative">
                <input
                  type="checkbox"
                  name="areas_of_interest"
                  value="{{ interest.name }}"
                  class="peer hidden interest-checkbox"
                />
                <div class="flex items-start p-3 bg-white border border-gray-200 rounded-md hover:border-blue-400 hover:shadow-sm transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50 h-full">
                  <div class="flex-shrink-0 mt-0.5 text-gray-400 peer-checked:text-blue-600">
                      <i class="fas {{interest.icon}} text-xl"></i>
                  </div>
                  <div class="ml-3">
                    <div class="text-sm font-semibold text-gray-900 peer-checked:text-blue-800 capitalize">
                      {{ interest.name.replace('_', ' ') }}
                    </div>
                    <div class="text-xs text-gray-500 mt-0.5 leading-tight">
                      {{ interest.description[:40] }}...
                    </div>
                  </div>
                </div>
              </label>
              {% endfor %}
            </div>
            <p class="text-xs text-gray-500 mt-2 text-right" id="interest-count">
              Selected: 0
            </p>
          </div>

          <!-- Tech Stack (Languages & Frameworks) -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-layer-group text-gray-400 mr-2"></i> Tech Stack
            </h4>

            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Languages</label>
                <div class="flex flex-wrap gap-2">
                  {% for lang in ['Python', 'JavaScript', 'Java', 'C++', 'C#', 'Ruby', 'Go', 'Swift', 'Kotlin', 'PHP', 'TypeScript', 'Rust'] %}
                  <label class="cursor-pointer">
                    <input type="checkbox" name="programming_languages" value="{{ lang }}" class="peer hidden" />
                    <span class="inline-block px-3 py-1.5 border border-gray-200 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 transition-colors shadow-sm">
                      {{ lang }}
                    </span>
                  </label>
                  {% endfor %}
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Frameworks</label>
                <div class="flex flex-wrap gap-2">
                  {% for framework in ['React', 'Vue.js', 'Angular', 'Node.js', 'Django', 'Flask', 'Spring', 'Express', 'Laravel', 'Rails', 'TensorFlow', 'PyTorch'] %}
                  <label class="cursor-pointer">
                    <input type="checkbox" name="frameworks_known" value="{{ framework }}" class="peer hidden" />
                    <span class="inline-block px-3 py-1.5 border border-gray-200 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 transition-colors shadow-sm">
                      {{ framework }}
                    </span>
                  </label>
                  {% endfor %}
                </div>
            </div>
          </div>

          <!-- Preferences & Goals -->
          <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center">
              <i class="fas fa-sliders-h text-gray-400 mr-2"></i> Preferences
            </h4>

            <div class="mb-4">
                 <label class="block text-sm font-semibold text-gray-700 mb-1">
                  Learning Goals
                </label>
                <textarea
                  name="learning_goals"
                  rows="2"
                  placeholder="What do you want to achieve?"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                ></textarea>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
              <!-- Time Commitment -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Time Commitment
                </label>
                <select
                  name="time_commitment"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                >
                  <option value="part_time">Part-time</option>
                  <option value="full_time">Full-time</option>
                  <option value="weekend_warrior">Weekends</option>
                </select>
              </div>

              <!-- Project Size -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Preferred Size
                </label>
                <select
                  name="preferred_project_size"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                >
                  <option value="small">Small (1-2 weeks)</option>
                  <option value="medium" selected>Medium (1-2 months)</option>
                  <option value="large">Large (3+ months)</option>
                </select>
              </div>

              <!-- Team Preference -->
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">
                  Team Preference
                </label>
                <select
                  name="team_preference"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white"
                >
                  <option value="solo">Solo</option>
                  <option value="small_team">Small team (2-3)</option>
                  <option value="large_team">Large team (4+)</option>
                  <option value="any" selected>No preference</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Footer Actions -->
          <div class="pt-6 border-t border-gray-200 flex justify-between items-center">
            <button
              type="button"
              onclick="window.location.href='{{ url_for('dashboard') }}'"
              class="text-gray-500 hover:text-blue-600 font-medium text-sm transition"
            >
              Skip for now
            </button>

            <button
              type="submit"
              class="bg-green-600 text-white px-8 py-2.5 rounded-md font-bold text-sm hover:bg-green-700 transition shadow-md hover:-translate-y-0.5 transform border border-green-700"
            >
              Save Profile
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Toast Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50"></div>
{% endblock %} 

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    createShootingStars(); 
  });

  /**
   * Create Shooting Stars Background Effect
   */
  function createShootingStars() {
    const starContainer = document.getElementById('star-container');
    const staticContainer = document.getElementById('static-star-container');
    const starCount = 15;
    const staticCount = 50;
    
    // 1. Create Shooting Stars
    for (let i = 0; i < starCount; i++) {
        const star = document.createElement('span');
        star.className = 'star';
        const top = Math.random() * 100;
        const left = Math.random() * 100;
        const delay = Math.random() * 5000;
        const duration = 3000 + Math.random() * 3000;
        star.style.top = top + '%';
        star.style.left = left + '%';
        star.style.width = (Math.random() * 100 + 100) + 'px';
        star.style.animationDelay = delay + 'ms';
        star.style.animationDuration = duration + 'ms';
        star.style.transform = 'rotateZ(45deg)';
        starContainer.appendChild(star);
    }

    // 2. Create Static Twinkling Stars
    for (let i = 0; i < staticCount; i++) {
        const dot = document.createElement('div');
        dot.className = 'static-star';
        const size = Math.random() * 2 + 1;
        dot.style.width = size + 'px';
        dot.style.height = size + 'px';
        dot.style.top = Math.random() * 100 + '%';
        dot.style.left = Math.random() * 100 + '%';
        dot.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
        dot.style.setProperty('--opacity', Math.random() * 0.5 + 0.1);
        staticContainer.appendChild(dot);
    }
  }

  // Track interest selections for visual logic
  document.querySelectorAll(".interest-checkbox").forEach((checkbox) => {
    checkbox.addEventListener("change", function () {
      const count = document.querySelectorAll(".interest-checkbox:checked").length;
      document.getElementById("interest-count").textContent = `Selected: ${count}`;
    });
  });

  // Reusing Toast function
  function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'transform transition-all duration-300 translate-x-full mb-4';
      let bgColor = 'bg-green-600'; 
      let icon = 'fa-check-circle';

      if (type === 'error') {
          bgColor = 'bg-red-600'; icon = 'fa-exclamation-circle';
      } else if (type === 'warning') {
          bgColor = 'bg-yellow-500'; icon = 'fa-exclamation-triangle';
      }

      toast.innerHTML = `
          <div class="${bgColor} text-white px-6 py-3 rounded-md shadow-lg flex items-center space-x-3 border border-transparent">
              <i class="fas ${icon}"></i>
              <span class="font-medium text-sm">${message}</span>
          </div>
      `;
      container.appendChild(toast);
      setTimeout(() => { toast.classList.remove('translate-x-full'); }, 10);
      setTimeout(() => {
          toast.classList.add('translate-x-full');
          setTimeout(() => { toast.remove(); }, 300);
      }, 3000);
  }

  // Simple loading overlay logic if not in base
  function showLoading() {
      // Optional: Add a simple spinner overlay if desired
  }
  function hideLoading() {}

  // Form submission logic
  document
    .getElementById("profile-form")
    .addEventListener("submit", function (e) {
      e.preventDefault();

      // Validate interests
      const interests = document.querySelectorAll(".interest-checkbox:checked");
      if (interests.length < 2) {
        showToast("Please select at least 2 areas of interest", "warning");
        return;
      }

      showLoading();

      const formData = new FormData(this);

      // Convert FormData to JSON
      const data = {
        education_level: formData.get("education_level"),
        current_year: formData.get("current_year"),
        field_of_study: formData.get("field_of_study"),
        bio: formData.get("bio"),
        linkedin_url: formData.get("linkedin_url"),
        github_url: formData.get("github_url"),
        overall_skill_level: formData.get("overall_skill_level"),
        areas_of_interest: formData.getAll("areas_of_interest"),
        programming_languages: formData.getAll("programming_languages"),
        frameworks_known: formData.getAll("frameworks_known"),
        learning_goals: formData.get("learning_goals"),
        time_commitment: formData.get("time_commitment"),
        preferred_project_size: formData.get("preferred_project_size"),
        team_preference: formData.get("team_preference"),
      };

      fetch('{{ url_for("profile_setup") }}', {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          hideLoading();
          if (data.success) {
            showToast("Profile saved!", "success");
            setTimeout(() => {
              window.location.href = '{{ url_for("dashboard") }}';
            }, 1000);
          } else {
            showToast(data.error || "Failed to update profile", "error");
          }
        })
        .catch((error) => {
          hideLoading();
          showToast("Error: " + error.message, "error");
        });
    });
</script>
{% endblock %}