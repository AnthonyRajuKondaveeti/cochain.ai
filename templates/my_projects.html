{% extends "base.html" %} {% block title %}My Projects - CoChain.ai{% endblock
%} {% block content %}
<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex justify-between items-center">
        <h1 class="text-xl font-semibold text-gray-900 flex items-center">
          <i class="far fa-folder mr-2 text-gray-500"></i>My Projects
        </h1>
        <a
          href="{{ url_for('create_project') }}"
          class="bg-green-600 text-white px-3 py-1.5 rounded-md text-sm font-bold hover:bg-green-700 transition shadow-sm border border-green-700 flex items-center"
        >
          <i class="fas fa-plus mr-2"></i>New
        </a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Tabs Navigation -->
    <div class="mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button
                    id="created-tab-btn"
                    class="border-orange-500 text-gray-900 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center"
                    onclick="switchTab('created')"
                >
                    <i class="fas fa-code-branch mr-2 text-gray-500"></i>
                    Created Projects
                </button>
                <button
                    id="joined-tab-btn"
                    class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center"
                    onclick="switchTab('joined')"
                >
                    <i class="fas fa-users mr-2 text-gray-400"></i>
                    Joined Projects
                    <span class="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs border border-gray-200">{{ joined_projects|length if joined_projects else 0 }}</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- Created Projects Content -->
    <div id="created-content" class="tab-content-panel">
        {% if created_projects %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for project in created_projects %}
          <!-- GitHub Repo Card Style -->
          <div class="bg-white border border-gray-200 rounded-md p-4 hover:border-gray-300 transition-colors flex flex-col h-full">
            <div class="flex justify-between items-start mb-2">
              <h3 class="font-semibold text-blue-600 text-lg hover:underline break-all">
                <a href="/live-projects/{{ project.id }}">{{ project.title }}</a>
              </h3>
              <span
                class="text-xs font-medium px-2 py-0.5 rounded-full border 
                {% if project.status == 'active' %}bg-green-50 text-green-700 border-green-200
                {% elif project.status == 'in_progress' %}bg-yellow-50 text-yellow-700 border-yellow-200
                {% else %}bg-gray-50 text-gray-600 border-gray-200{% endif %}"
              >
                {{ project.status|title if project.status else 'Public' }}
              </span>
            </div>

            <p class="text-gray-600 text-sm mb-4 flex-grow">
              {{ project.description[:120] }}{% if project.description|length > 120 %}...{% endif %}
            </p>

            {% if project.tech_stack %}
            <div class="flex flex-wrap gap-2 mb-4">
              {% for tech in project.tech_stack[:4] %}
              <span class="bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded-full font-medium border border-blue-100">{{ tech }}</span>
              {% endfor %}
              {% if project.tech_stack|length > 4 %}
              <span class="bg-gray-50 text-gray-500 text-xs px-2 py-0.5 rounded-full border border-gray-200">+{{ project.tech_stack|length - 4 }}</span>
              {% endif %}
            </div>
            {% endif %}

            <div class="flex items-center text-xs text-gray-500 mb-4 space-x-4">
               <span class="flex items-center">
                  <div class="w-2 h-2 rounded-full bg-{{ 'green' if project.status == 'active' else 'yellow' }}-500 mr-1.5"></div>
                  {{ project.domain or 'General' }}
               </span>
               <span class="flex items-center">
                  <i class="far fa-clock mr-1"></i> Updated {{ project.created_at[:10] if project.created_at else 'recently' }}
               </span>
            </div>

            <!-- Action Buttons Footer -->
            <div class="pt-3 border-t border-gray-100 flex items-center justify-between">
                <div class="text-xs text-gray-500">
                    <i class="fas fa-users mr-1"></i> {{ project.current_collaborators or 1 }}/{{ project.max_collaborators }}
                </div>
                
                <div class="flex space-x-2">
                    <button
                        onclick="window.location.href='/edit-project/{{ project.id }}'"
                        class="bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-300 px-2 py-1 rounded-md text-xs font-medium transition shadow-sm"
                        title="Edit"
                    >
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                    <button
                        onclick="deleteProject('{{ project.id }}', '{{ project.title }}')"
                        class="bg-white hover:bg-red-50 text-red-600 border border-gray-300 px-2 py-1 rounded-md text-xs font-medium transition shadow-sm"
                        title="Delete"
                    >
                        <i class="far fa-trash-alt"></i>
                    </button>
                </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <!-- Empty State Created -->
        <div class="text-center py-16 border border-dashed border-gray-300 rounded-md bg-white">
          <i class="far fa-folder-open text-gray-400 text-4xl mb-4"></i>
          <h3 class="text-base font-bold text-gray-900 mb-1">You haven't created any projects yet</h3>
          <p class="text-sm text-gray-500 mb-6">Share your ideas and find collaborators.</p>
          <a
            href="{{ url_for('create_project') }}"
            class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition font-bold text-sm border border-green-700 shadow-sm"
          >
            Create Project
          </a>
        </div>
        {% endif %}
    </div>

    <!-- Joined Projects Content -->
    <div id="joined-content" class="tab-content-panel" style="display: none;">
        {% if joined_projects %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for project in joined_projects %}
          <div class="bg-white border border-gray-200 rounded-md p-4 hover:border-gray-300 transition-colors flex flex-col h-full">
            <div class="flex justify-between items-start mb-2">
              <h3 class="font-semibold text-blue-600 text-lg hover:underline break-all">
                 <a href="/live-projects/{{ project.id }}">{{ project.title }}</a>
              </h3>
              <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 border border-gray-200">
                {{ project.member_role|title if project.member_role else 'Member' }}
              </span>
            </div>

            <p class="text-gray-600 text-sm mb-4 flex-grow">
              {{ project.description[:100] }}{% if project.description|length > 100 %}...{% endif %}
            </p>

            {% if project.tech_stack %}
            <div class="flex flex-wrap gap-2 mb-4">
              {% for tech in project.tech_stack[:3] %}
              <span class="bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-full border border-gray-200">{{ tech }}</span>
              {% endfor %}
            </div>
            {% endif %}
            
            <div class="pt-3 border-t border-gray-100 flex items-center justify-between">
                 <div class="flex items-center text-xs text-gray-500">
                    <i class="fas fa-users mr-1"></i> {{ project.current_collaborators or 1 }}/{{ project.max_collaborators }}
                 </div>
                 <a href="/live-projects/{{ project.id }}" class="text-xs font-semibold text-blue-600 hover:underline">
                    View Project <i class="fas fa-arrow-right ml-1"></i>
                 </a>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <!-- Empty State Joined -->
        <div class="text-center py-16 border border-dashed border-gray-300 rounded-md bg-white">
          <i class="fas fa-users text-gray-400 text-4xl mb-4"></i>
          <h3 class="text-base font-bold text-gray-900 mb-1">No joined projects yet</h3>
          <p class="text-sm text-gray-500 mb-6">Explore the community and join projects that interest you.</p>
          <a
            href="{{ url_for('explore') }}"
            class="bg-white text-blue-600 px-4 py-2 rounded-md hover:bg-gray-50 transition font-bold text-sm border border-gray-300 shadow-sm"
          >
            Explore Projects
          </a>
        </div>
        {% endif %}
    </div>
  </div>
</div>

<script>
function switchTab(tabName) {
  // Hide all tab content panels
  document.querySelectorAll('.tab-content-panel').forEach(panel => {
    panel.style.display = 'none';
  });
  
  // Reset all tab buttons to default inactive state
  const tabs = ['created', 'joined'];
  tabs.forEach(t => {
      const btn = document.getElementById(t + '-tab-btn');
      // Remove active classes
      btn.classList.remove('border-orange-500', 'text-gray-900');
      // Add inactive classes
      btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
  });
  
  // Show selected tab content
  document.getElementById(tabName + '-content').style.display = 'block';
  
  // Add active styling to clicked button
  const activeBtn = document.getElementById(tabName + '-tab-btn');
  activeBtn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
  activeBtn.classList.add('border-orange-500', 'text-gray-900');
}

function deleteProject(projectId, projectTitle) {
  if (!confirm(`Are you sure you want to delete "${projectTitle}"?\n\nThis action cannot be undone.`)) {
    return;
  }
  
  fetch(`/api/projects/${projectId}`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    if (data.success) {
      showToast('Project deleted successfully', 'success');
      // Reload page immediately with cache bypass
      setTimeout(() => {
        window.location.href = window.location.href.split('?')[0] + '?t=' + new Date().getTime();
      }, 500);
    } else {
      showToast('Error deleting project: ' + (data.error || 'Unknown error'), 'error');
    }
  })
  .catch(error => {
    console.error('Delete error:', error);
    showToast('Failed to delete project', 'error');
  });
}
</script>
{% endblock %}