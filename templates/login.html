{% extends "base.html" %} {% block title %}Login - CoChain.ai{% endblock %} {%
block content %}
<div
  class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"
>
  <div class="max-w-sm w-full">
    <!-- Logo and Title -->
    <div class="text-center mb-8">
      <div class="flex justify-center mb-4">
        <i class="fas fa-link text-gray-900 text-5xl"></i>
      </div>
      <h2 class="text-2xl font-light text-gray-900 mb-2">
        Sign in to CoChain.ai
      </h2>
    </div>

    <!-- Login Form Card -->
    <div
      class="bg-white rounded-md shadow-sm border border-gray-200 p-6 sm:p-8"
    >
      <form id="login-form" method="POST" action="{{ url_for('login') }}">
        <!-- Email -->
        <div class="mb-4">
          <label class="block text-gray-900 font-semibold text-sm mb-2">
            Email address
          </label>
          <input
            type="email"
            name="email"
            id="email"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm bg-gray-50"
            placeholder="name@example.com"
          />
        </div>

        <!-- Password -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <label class="block text-gray-900 font-semibold text-sm">
              Password
            </label>
            <a
              href="#"
              class="text-xs text-blue-600 hover:text-blue-800 hover:underline"
            >
              Forgot password?
            </a>
          </div>
          <div class="relative">
            <input
              type="password"
              name="password"
              id="password"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm bg-gray-50"
            />
            <button
              type="button"
              onclick="togglePassword()"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-blue-600"
            >
              <i id="password-icon" class="far fa-eye"></i>
            </button>
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full bg-green-600 text-white px-4 py-2 rounded-md font-bold hover:bg-green-700 transition shadow-sm border border-green-700"
        >
          Sign in
        </button>
      </form>
    </div>

    <!-- Register Link Box -->
    <div
      class="mt-4 p-4 border border-gray-200 rounded-md text-center bg-white shadow-sm"
    >
      <span class="text-sm text-gray-600">New to CoChain?</span>
      <a
        href="{{ url_for('register') }}"
        class="text-sm text-blue-600 hover:text-blue-800 hover:underline ml-1"
      >
        Create an account
      </a>
    </div>

    <!-- Footer Links -->
    <div class="mt-8 flex justify-center space-x-4 text-xs text-gray-500">
      <a href="#" class="hover:text-blue-600 hover:underline">Terms</a>
      <a href="#" class="hover:text-blue-600 hover:underline">Privacy</a>
      <a href="#" class="hover:text-blue-600 hover:underline">Security</a>
      <a href="#" class="hover:text-blue-600 hover:underline">Contact GitHub</a>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function togglePassword() {
    const passwordInput = document.getElementById("password");
    const passwordIcon = document.getElementById("password-icon");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      passwordIcon.classList.remove("fa-eye");
      passwordIcon.classList.add("fa-eye-slash");
    } else {
      passwordInput.type = "password";
      passwordIcon.classList.remove("fa-eye-slash");
      passwordIcon.classList.add("fa-eye");
    }
  }

  document
    .getElementById("login-form")
    .addEventListener("submit", function (e) {
      e.preventDefault();
      showLoading();

      const formData = new FormData(this);
      const data = {
        email: formData.get("email"),
        password: formData.get("password"),
      };

      // Validate inputs
      if (!data.email || !data.password) {
        hideLoading();
        showToast("Please enter both email and password", "error");
        return;
      }

      console.log("ðŸ” Attempting login for:", data.email);

      fetch('{{ url_for("login") }}', {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => {
          console.log("ðŸ“¡ Login response status:", response.status);
          return response.json();
        })
        .then((data) => {
          console.log("ðŸ“ Login response data:", data);
          hideLoading();

          if (data.success) {
            console.log("âœ… Login successful, redirecting to:", data.redirect);
            showToast(data.message || "Login successful!", "success");
            setTimeout(() => {
              window.location.href =
                data.redirect || '{{ url_for("dashboard") }}';
            }, 1000);
          } else {
            console.log(
              "âŒ Login failed:",
              data.error,
              "Type:",
              data.error_type
            );

            // Show specific error messages
            let errorMessage = data.error || "Login failed";
            let toastType = "error";

            if (data.error_type === "invalid_credentials") {
              errorMessage = "Incorrect username or password.";
            } else if (data.error_type === "missing_credentials") {
              errorMessage = "Please enter both email and password.";
            }

            showToast(errorMessage, toastType);
          }
        })
        .catch((error) => {
          console.error("ðŸ’¥ Login request failed:", error);
          hideLoading();
          showToast(
            "Network error. Please check your connection and try again.",
            "error"
          );
        });
    });
</script>
{% endblock %}
